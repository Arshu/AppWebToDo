(function(e){var f={method:"GET",icon:"arrow-r",cancelRequests:false,target:e(),source:null,callback:null,link:null,data:{},minLength:0,transition:"fade",matchFromStart:true,labelHTML:function(i){return i},onNoResults:function(){return},onLoading:function(){return},onLoadingFinished:function(){return},termParam:"term",loadingHtml:'<li data-icon="false"><a href="#">Searching...</a></li>',interval:0,builder:null,dataHandler:null,klass:null,forceFirstChoiceOnEnterKey:true,autoClearOnDel:true,transformResponse:null,filterCleared:null},b={},h=function(l,k,j){var m,i="";if(j.klass){i='class="'+j.klass+'"'}if(j.builder){m=j.builder.apply(l.eq(0),[k,j])}else{m=[];if(k){if(j.dataHandler){k=j.dataHandler(k)}e.each(k,function(n,o){if(e.isPlainObject(o)){if(j.transformResponse){o=j.transformResponse(o)}m.push("<li "+i+" data-icon="+j.icon+'><a href="'+j.link+encodeURIComponent(o.value)+'" data-transition="'+j.transition+"\" data-autocomplete='"+JSON.stringify(o).replace(/'/g,"&#39;")+"'>"+j.labelHTML(o.label)+"</a></li>")}else{m.push("<li "+i+" data-icon="+j.icon+'><a href="'+j.link+encodeURIComponent(o)+'" data-transition="'+j.transition+'">'+j.labelHTML(o)+"</a></li>")}})}}if(e.isArray(m)){m=m.join("")}e(j.target).html(m).listview("refresh");if(j.callback!==null&&e.isFunction(j.callback)){d(j)}if(m.length>0){l.trigger("targetUpdated.autocomplete")}else{l.trigger("targetCleared.autocomplete");if(j.onNoResults){j.onNoResults()}}},d=function(i){e("li a",e(i.target)).bind("click.autocomplete",function(j){j.stopPropagation();j.preventDefault();i.callback(j)})},c=function(j,i){i.html("").listview("refresh").closest("fieldset").removeClass("ui-search-active");j.trigger("targetCleared.autocomplete")},g=function(o){var p=e(this),i=p.attr("id"),s,m,j=p.jqmData("autocomplete"),n,t;if(!Date.now){Date.now=function(){return new Date().valueOf()}}if(o){if(o.keyCode===38){e(".ui-btn-active",e(j.target)).removeClass("ui-btn-active").prevAll("li.ui-btn:eq(0)").addClass("ui-btn-active").length||e(".ui-btn:last",e(j.target)).addClass("ui-btn-active")}else{if(o.keyCode===40){e(".ui-btn-active",e(j.target)).removeClass("ui-btn-active").nextAll("li.ui-btn:eq(0)").addClass("ui-btn-active").length||e(".ui-btn:first",e(j.target)).addClass("ui-btn-active")}else{if(o.keyCode===13&&j.forceFirstChoiceOnEnterKey){e(".ui-btn-active a",e(j.target)).click().length||e(".ui-btn:first a",e(j.target)).click()}else{if(((o.keyCode===8)||(o.keyCode===46))&&j.autoClearOnDel){p.val("");if(j.filterCleared){j.filterCleared()}}}}}}if(j){s=p.val();if(j._lastText===s){return}j._lastText=s;if(j._retryTimeout){window.clearTimeout(j._retryTimeout);j._retryTimeout=null}if(o&&(o.keyCode===13||o.keyCode===38||o.keyCode===40)){return}if(s.length<j.minLength){c(p,e(j.target))}else{if(j.interval&&Date.now()-j._lastRequest<j.interval){j._retryTimeout=window.setTimeout(e.proxy(g,this),j.interval-Date.now()+j._lastRequest);return}j._lastRequest=Date.now();if(e.isArray(j.source)){var r=function(k){return k.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")};m=j.source.sort().filter(function(k){if(j.matchFromStart){n,t=new RegExp("^"+r(s),"i")}else{n,t=new RegExp(r(s),"i")}if(e.isPlainObject(k)){n=k.label}else{n=k}return t.test(n)});h(p,m,j)}else{if(typeof j.source==="function"){j.source(s,function(k){h(p,k,j)})}else{var q={type:j.method,data:j.data,dataType:"json",beforeSend:function(k){if(j.cancelRequests){if(b[i]){b[i].abort()}else{}b[i]=k}if(j.onLoading&&j.onLoadingFinished){j.onLoading()}if(j.loadingHtml){e(j.target).html(j.loadingHtml).listview("refresh");e(j.target).closest("fieldset").addClass("ui-search-active")}},success:function(k){h(p,k,j)},complete:function(){if(j.cancelRequests){b[i]=null}if(j.onLoadingFinished){j.onLoadingFinished()}}};if(e.isPlainObject(j.source)){if(j.source.callback){j.source.callback(s,q)}for(var l in j.source){if(l!=="callback"){q[l]=j.source[l]}}}else{q.url=j.source}if(j.termParam){q.data[j.termParam]=s}e.ajax(q)}}}}},a={init:function(i){var k=this;k.jqmData("autocomplete",e.extend({},f,i));var j=k.jqmData("autocomplete");return k.unbind("keyup.autocomplete").bind("keyup.autocomplete",g).next(".ui-input-clear").bind("click",function(){c(k,e(j.target))})},update:function(i){var j=this.jqmData("autocomplete");if(j){this.jqmData("autocomplete",e.extend(j,i))}return this},clear:function(){var i=this.jqmData("autocomplete");if(i){c(this,e(i.target))}return this},destroy:function(){var i=this.jqmData("autocomplete");if(i){c(this,e(i.target));this.jqmRemoveData("autocomplete");this.unbind(".autocomplete")}return this}};e.fn.autocomplete=function(i){if(a[i]){return a[i].apply(this,Array.prototype.slice.call(arguments,1))}else{if(typeof i==="object"||!i){return a.init.apply(this,arguments)}}}})(jQuery);